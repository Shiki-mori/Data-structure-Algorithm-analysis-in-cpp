# C++细节
## 1.5.1 指针 pointer
```cpp
//1.11 使用指向IntCell的指针
#include <iostream>
using namespace std;
class IntCell {
public:
  explicit IntCell(int initialValue = 0) : storedValue{initialValue} {};
  int read() const { return storedValue; }
  void write(int x) { storedValue = x; }

private:
  int storedValue;
};
int main() {
  IntCell *m = nullptr;

  m = new IntCell{0};
  m->write(5);
  cout << "Cell contents: " << m->read();

  delete m;
  return 0;
}
```
将程序1.9改写为为IntCell动态分配内存。  
C++不检验指针在使用前是否被赋值。未经初始化指针的使用通常会使程序崩溃。  
- 对象的动态创建  
new操作符返回一个指向新创建对象的指针。  
使用无参构造函数创建对象：  
`m = new IntCell();`  
`m = new IntCell{};`  
`m = new IntCell;  //本书首选`  
- 垃圾收集与delete  
某些语言在对象不再被引用时自动进行垃圾回收。C++不进行垃圾回收。必须使用delete操作。否则直到程序终止，该对象使用的内存将会丢失，称为内存泄漏（memory leak）。这在许多C++程序中普遍存在。很多内存泄漏源可自动被审慎地清除。一个重要规则是，在能够使用自动变量的时候不要使用new 操作符。  
- 指针的赋值和比较  
C++中指针变量的赋值和比较基于指针的值，即其所存储的地址。  
于是，指针指向相同对象，则指针变量相等。  
- 通过指针访问对象成员  
指针变量指向类类型的对象，则所指对象的可见成员能通过->操作符被访问。  
- 取地址操作符 & address-of operator  
该操作符返回一个对象所占用的内存地址。  
## 1.5.2 左值，右值，引用  
引用类型（reference type）  
新的引用类型的创建，叫做右值引用（rvalue reference）。  

左值（lvalue）是标识非临时性对象的表达式。  
右值（rvalue）是标识临时性对象的表达式，或者不与任何对象相联系的值。  

考虑如下代码：  
```cpp
vector<string> arr(3);
const int x = 2;
int y;
int z = x + y;
string str = "foo";
vector<string> *ptr = &arr;
```
一般法则是，如果程序中有一个变量名，那么它就是左值，而不论是否可被修改。  
字面值（literal）是右值。  
如果函数调用计算一个其值在被调用前不存在，且调用终止后就不再存在的表达式，那么它很可能是一个右值，除非在别处被复制。

引用类型允许为已存在的值定义新名字。  
传统C++中，引用一般只能是左值的名字。若对临时量引用，则导致对理论上已经声明不再需要的对象的访问的能力，这样可能让它的资源被声明为另外的对象所用。  
C++11中，有两种类型的引用，左值引用和右值引用。  

**2026/1/11 20:24**

**左值引用**   
声明：在某个类型后放置一个符号&。左值引用成为它所引用的对象的同义词。  
```cpp

# 使用矩阵
第10章的几个算法使用二维数组，一般称为**矩阵**（matrix）。C++库不提供matrix类。不过，合理的matrix类可以很快写出来。基本想法是使用向量的向量来完成。这个工作需要操作符重载的附加知识。对于matrix类，我们为其定义operator[]，即数组下标运算符（array-indexing operator）。matrix类在1.26中给出。
```cpp
// 1.26 一个完整的matrix类
#ifndef MATRIX_H
#define MATRIX_H

#include <vector>
using namespace std;

template <typename Object> class matrix {
public:
  matrix(int rows, int cols) : array(rows) {
    for (auto &thisRow : array)
      thisRow.resize(cols);
  }

  matrix(vector<vector<Object>> v) : array{v} {}
  matrix(vector<vector<Object>> &&v) : array{std::move(v)} {}

  const vector<Object> &operator[](int row) const { return array[row]; }
  vector<Object> &operator[](int row) { return array[row]; }

  int numrows() const { return array.size(); }
  int numcols() const {
    return numrows() ? array[0].size() : 0;
  } // 避免访问array[0]可能导致的数组越界

private:
  vector<vector<Object>> array;
};
#endif
```
*2026/1/15 15:43*
## 1.7.1 数据成员，构造函数和基本访问函数
矩阵通过array型数据成员表示。该数据成员被声明为vector\<Object\>的一个vector类的对象。构造函数首先把array构造成具有rows个元素，每个元素都是vector\<Object\>类型对象，这些对象均是由无参构造函数构造而得的向量。于是有rows个零长度的Object向量。  
然后进入构造函数的函数体。每行的大小被调整为有cols个列位置。构造函数完成。  
numrows和numcols是两个基本访问函数。
## 1.7.2 operator[]
operator的思路：有一个矩阵m，那么m[i]应该返回对应m的第i行的向量。若是这样，则经过正常的vector的下标运算，m[i][j]将返回相应位置的元素。因此，matrix的operator[]返回一个vector\<Object\>类型的实体，而不是Object对象。  

接下来实现这个operator[]。我们需要返回一个vector\<Object\>类型的实体，那么应该选择何种返回呢？首先排除传值返回，因为返回的实体是复杂的，并且被调用后保证存在。考虑下面的方法：  
```cpp
void copy(const matrix<int> &from, matrix<int> &to) {
  for (int i = 0; i < to.numrows(); i++)
    to[i] = from[i];
}
```
在copy函数中，试图将matrix from的每一行复制到matrix to的对应行。如果operator[]返回常量引用，那么to[i]不能出现在赋值语句的左侧。因此operator[]应该返回一个引用。但是如果真是这样，from[i] = to[i]这样的表达式就会编译，因为即使from是常量矩阵，from[i]也不会是一个常向量。from是常量，那么C++会尝试调用非常量版本的operator[]，但是不能对常量对象调用非常量成员函数，这不应该被编译。

因此，我们需要让operator[]返回一个from的常量引用，而不是to的简单引用。我们需要两种版本的operator[]，它们只在返回类型上不同，这是不允许的。然而，由于成员函数的定常性（const-ness，即是否为const）是特征的一部分，因此可以让operator[]的访问函数版返回常量引用，修改函数版返回引用。  
## 1.7.3 五大函数
五大函数均可被自动处理。因为vector已经对其做了处理。这里所列出的是功能完整的matrix类所需要的全部代码。